<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Calendar</title>
<!-- Google Fonts link for Confortaa -->
<link href="https://fonts.googleapis.com/css2?family=Confortaa:wght@700&display=swap" rel="stylesheet">
<style>
  body { 
    margin:0; 
    font-family:"Confortaa", monospace; 
    font-weight:3000; 
    background:#1e1e1e; 
    color:#eee; 
    display:flex; 
    height:100vh; 
  }
  #sidebar { width:250px; background:#2b2b2b; padding:10px; overflow-y:auto; }
  #calendar-container { flex:1; display:flex; flex-direction:column; }
  #calendar-header { display:flex; justify-content:space-between; align-items:center; padding:10px; }
  #calendar-header button{ margin-left: 5px; padding: 6px 10px; border-radius: 6px; border: none; background: #4CAF50; color: white; cursor: pointer; font-weight: bold;}
  #calendar-header button:first-child {margin-left: 0;} 
  #calendar-header button:hover {background: #45a049;}
  #calendar { display:grid; grid-template-columns:repeat(7,1fr); grid-auto-rows: minmax(100px, auto); flex:1; padding:10px; gap:5px; }
  .weekday { 
    text-align:center; 
    font-weight:bold; 
    font-size:3.5em; 
    line-height:2.2em; 
  }
  .day { border:1px solid #444; border-radius:12px; padding:4px; min-height:100px; max-height:150px; overflow-y:auto; background:#2a2a2a; cursor:pointer; }
  .day strong { display:block; margin-bottom:4px; }
  .event { display:flex; justify-content:space-between; align-items:center; margin:2px 0; padding:2px 4px; border-radius:6px; font-size:12px; cursor:pointer; }
  .event button { background:none; border:none; color:white; font-size:10px; cursor:pointer; margin-left:4px; }
  .exam { background:#d32f2f; color:#fff; }
  .handin { background:#1976d2; color:#fff; }
  .other { background:#388e3c; color:#fff; }
  .highlight { outline:2px solid yellow; }
  .completed { background:#555 !important; text-decoration:line-through; }
  #filters { margin:10px 0; }
  #filters button { border:none; margin:2px; padding:5px 8px; border-radius:6px; cursor:pointer; font-family:inherit; font-weight:inherit; }
  #filters .examBtn { background:#d32f2f; color:#fff; }
  #filters .handinBtn { background:#1976d2; color:#fff; }
  #filters .otherBtn { background:#388e3c; color:#fff; }
  #upcomingList { margin-top:10px; }
  .upcoming-date-box { background:#3a3a3a; border-radius:8px; padding:5px; margin-bottom:8px; }
  .upcoming-event { display:flex; justify-content:space-between; align-items:center; margin-left:10px; margin-bottom:4px; border-radius:6px; padding:2px 6px; cursor:pointer; }
  .modal { display:none; position:fixed; z-index:10; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
  .modal-content { background:#2b2b2b; padding:20px; border-radius:12px; width:320px; color:#eee; }
  .modal-content input, .modal-content select, .modal-content textarea { width:100%; margin-bottom:10px; padding:6px; border-radius:6px; border:none; font-family:inherit; background:#444; color:#eee; }
  .modal-content button { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; margin:3px 2px; font-family:inherit; }
  .typeBtn { margin:2px; padding:5px 10px; border-radius:6px; border:none; cursor:pointer; }
  .typeBtn.active { outline:2px solid #fff; }
  .examBtn { background:#d32f2f; color:#fff; }
  .handinBtn { background:#1976d2; color:#fff; }
  .otherBtn { background:#388e3c; color:#fff; }
  body.winter { color: #b3e5fc; }   
  body.spring { color: #a5d6a7; }   
  body.summer { color: #ffeb3b; }   
  body.autumn { color: #ffcc80; }   
  #todayBtn {background: #4CAF50; color: #fff; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transition: background 0.2s;}
  #todayBtn:hover {background: #45a049;}
</style>
</head>
<body>
<div id="sidebar">
  <h3>Upcoming</h3>
  <div id="filters">
    <button class="examBtn" onclick="toggleFilter('exam')">Exam</button>
    <button class="handinBtn" onclick="toggleFilter('handin')">Hand-in</button>
    <button class="otherBtn" onclick="toggleFilter('other')">Other</button>
  </div>
  <div id="upcomingList"></div>
</div>

<div id="calendar-container">
  <div id="calendar-header">
    <button onclick="prevMonth()">◀</button>
    <div style="display:flex; align-items:center; gap:10px;">
      <h2 id="monthYear"></h2>
      <select id="monthSelect" onchange="jumpToMonth()">
        <option value="0">January</option>
        <option value="1">February</option>
        <option value="2">March</option>
        <option value="3">April</option>
        <option value="4">May</option>
        <option value="5">June</option>
        <option value="6">July</option>
        <option value="7">August</option>
        <option value="8">September</option>
        <option value="9">October</option>
        <option value="10">November</option>
        <option value="11">December</option>
      </select>
      <div>
        <button onclick="openSettings()">⚙️</button>
        <button onclick="goToToday()">Today</button>
        <button onclick="nextMonth()">▶</button>
      </div>
    </div>
  </div>
  <div id="calendar"></div>
</div>

<!-- Event Creation Modal -->
<div class="modal" id="newEventModal">
  <div class="modal-content">
    <h3>New Event</h3>
    <input type="text" id="newEventTitle" placeholder="Title">
    <div>
      <button class="typeBtn examBtn" data-type="exam" onclick="selectType(this)">Exam</button>
      <button class="typeBtn handinBtn" data-type="handin" onclick="selectType(this)">Hand-in</button>
      <button class="typeBtn otherBtn" data-type="other" onclick="selectType(this)">Other</button>
    </div>
    <textarea id="newEventDesc" placeholder="Description"></textarea>
    <p>Recurrence:</p>
    <select id="newEventFrequency">
      <option value="none">None</option>
      <option value="weekly">Weekly</option>
    </select>
    <button onclick="saveNewEvent()">Save</button>
    <button onclick="repeatForSemester()">Repeat for Semester</button>
    <button onclick="closeNewEvent()">Cancel</button>
  </div>
</div>

<!-- Event Detail Modal -->
<div class="modal" id="eventDetailModal">
  <div class="modal-content">
    <h3 id="detailTitle"></h3>
    <textarea id="detailDesc"></textarea>
    <div>
      <button onclick="saveEdit(false)">Save (This Event)</button>
      <button onclick="saveEdit(true)">Save (All Weekly)</button>
    </div>
    <div>
      <button onclick="deleteEvent(false)">Delete (This Event)</button>
      <button onclick="deleteEvent(true)">Delete (All Weekly)</button>
    </div>
    <div>
      <button onclick="toggleComplete()">✔️ Toggle Complete</button>
    </div>
    <button onclick="closeEventDetail()">Close</button>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <h3>Settings</h3>
    <label>Semester Start</label>
    <input type="date" id="semesterStart">
    <label>Semester End</label>
    <input type="date" id="semesterEnd">
    <button onclick="saveSettings()">Save</button>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
let currentDate=new Date();
let events=JSON.parse(localStorage.getItem("events")||"{}");
let settings=JSON.parse(localStorage.getItem("settings")||"{}");
let filters=["exam","handin","other"];
let pendingDateStr=null;
let currentDetail={dateStr:null,index:null,event:null};

function saveEvents(){ localStorage.setItem("events",JSON.stringify(events)); }
function saveSettings(){ settings.semesterStart=document.getElementById("semesterStart").value; settings.semesterEnd=document.getElementById("semesterEnd").value; localStorage.setItem("settings",JSON.stringify(settings)); closeSettings(); }
function openSettings(){ document.getElementById("semesterStart").value=settings.semesterStart||""; document.getElementById("semesterEnd").value=settings.semesterEnd||""; document.getElementById("settingsModal").style.display="flex"; }
function closeSettings(){ document.getElementById("settingsModal").style.display="none"; }

function selectType(button){ document.querySelectorAll(".typeBtn").forEach(b=>b.classList.remove("active")); button.classList.add("active"); }
function toggleFilter(type){ if(filters.includes(type)) filters=filters.filter(t=>t!==type); else filters.push(type); renderCalendar(); }
function prevMonth(){ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); }
function jumpToMonth(){const month = parseInt(document.getElementById("monthSelect").value);currentDate.setMonth(month); renderCalendar();}
function nextMonth(){ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); }

function openNewEvent(dateStr){ pendingDateStr=dateStr; document.getElementById("newEventTitle").value=""; document.getElementById("newEventDesc").value=""; document.querySelectorAll(".typeBtn").forEach(b=>b.classList.remove("active")); document.getElementById("newEventModal").style.display="flex"; }
function closeNewEvent(){ document.getElementById("newEventModal").style.display="none"; }

function saveNewEvent(){
  if(!pendingDateStr) return;
  const title=document.getElementById("newEventTitle").value.trim();
  if(!title) return alert("Enter a title");
  const type=document.querySelector(".typeBtn.active")?.getAttribute('data-type')||'other';
  const desc=document.getElementById("newEventDesc").value;
  const freq=document.getElementById("newEventFrequency").value;
  if(!events[pendingDateStr]) events[pendingDateStr]=[];
  events[pendingDateStr].push({title,type,desc,completed:false,recurrence:freq,origin:pendingDateStr});
  saveEvents(); closeNewEvent(); renderCalendar();
}

function repeatForSemester(){
  if(!pendingDateStr) return;
  const title=document.getElementById("newEventTitle").value.trim();
  if(!title) return alert("Enter a title");
  const type=document.querySelector(".typeBtn.active")?.getAttribute('data-type')||'other';
  const desc=document.getElementById("newEventDesc").value;
  const freq=document.getElementById("newEventFrequency").value;
  if(!settings.semesterEnd) return alert("Set semester end date in settings!");
  let currentDateIter=new Date(pendingDateStr);
  currentDateIter.setHours(0,0,0,0);
  const semesterEnd=new Date(settings.semesterEnd);
  semesterEnd.setHours(0,0,0,0);
  while(currentDateIter<=semesterEnd){
    const dateStr=`${currentDateIter.getFullYear()}-${String(currentDateIter.getMonth()+1).padStart(2,"0")}-${String(currentDateIter.getDate()).padStart(2,"0")}`;
    if(!events[dateStr]) events[dateStr]=[];
    events[dateStr].push({title,type,desc,completed:false,recurrence:freq,origin:pendingDateStr});
    if(freq==="weekly"){ currentDateIter.setDate(currentDateIter.getDate()+7); }
    else break;
  }
  saveEvents(); closeNewEvent(); renderCalendar();
}

function getEventInstancesForRange(start,end){
  let arr=[];
  for(const [dateStr,evts] of Object.entries(events)){
    const [y,m,d]=dateStr.split("-").map(Number);
    const dt=new Date(y,m-1,d);
    if(dt>=start && dt<=end){
      evts.forEach((e,i)=>arr.push({...e,date:dt,dateStr,index:i}));
    }
  }
  return arr;
}

function openEventDetail(evt){ currentDetail={dateStr:evt.dateStr,index:evt.index,event:evt}; document.getElementById("detailTitle").textContent=evt.title; document.getElementById("detailDesc").value=evt.desc||""; document.getElementById("eventDetailModal").style.display="flex"; }
function closeEventDetail(){ document.getElementById("eventDetailModal").style.display="none"; currentDetail={dateStr:null,index:null,event:null}; }

function saveEdit(all){
  if(!currentDetail.dateStr) return;
  const newDesc=document.getElementById("detailDesc").value;
  const ev=events[currentDetail.dateStr][currentDetail.index];
  ev.desc=newDesc;
  if(all && ev.recurrence==="weekly"){
    for(const [dateStr,evts] of Object.entries(events)){
      evts.forEach(e=>{ if(e.origin===ev.origin){ e.title=ev.title; e.type=ev.type; e.desc=newDesc; } });
    }
  }
  saveEvents(); renderCalendar(); closeEventDetail();
}

function deleteEvent(all){
  if(!currentDetail.dateStr) return;
  const ev=events[currentDetail.dateStr][currentDetail.index];
  if(all && ev.recurrence==="weekly"){
    for(const [dateStr,evts] of Object.entries(events)){
      events[dateStr]=evts.filter(e=>e.origin!==ev.origin);
      if(events[dateStr].length===0) delete events[dateStr];
    }
  } else {
    events[currentDetail.dateStr].splice(currentDetail.index,1);
    if(events[currentDetail.dateStr].length===0) delete events[currentDetail.dateStr];
  }
  saveEvents(); renderCalendar(); closeEventDetail();
}

function toggleComplete(){
  if(!currentDetail.dateStr) return;
  const ev=events[currentDetail.dateStr][currentDetail.index];
  ev.completed=!ev.completed;
  saveEvents(); renderCalendar(); closeEventDetail();
}

function renderCalendar(){
  const year=currentDate.getFullYear(), month=currentDate.getMonth();
  let firstDay=new Date(year,month,1).getDay(); 
  firstDay = (firstDay + 6) % 7; // Monday start
  const daysInMonth=new Date(year,month+1,0).getDate();
  applySeasonalTheme(month);
  document.getElementById("monthYear").textContent=currentDate.toLocaleDateString("default",{month:"long"})+" "+year;
  const calendar=document.getElementById("calendar"); calendar.innerHTML="";
  
  // Weekday labels
  const weekdays = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  weekdays.forEach(dayName => {
    const headerCell = document.createElement("div");
    headerCell.className = "weekday";
    headerCell.textContent = dayName;
    calendar.appendChild(headerCell);
  });

  const todayDate=new Date(); todayDate.setHours(0,0,0,0);
  for(let i=0;i<firstDay;i++){ calendar.appendChild(document.createElement("div")); }
  for(let day=1;day<=daysInMonth;day++){
    const dateStr=`${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    let cell=document.createElement("div"); cell.className="day";
    if(new Date(year,month,day).toDateString()===todayDate.toDateString()) cell.classList.add("highlight");
    cell.innerHTML=`<strong>${day}</strong><div class="events-container"></div>`;
    const container=cell.querySelector(".events-container");
    const dayStart=new Date(year,month,day,0,0,0);
    const dayEnd=new Date(year,month,day,23,59,59);
    getEventInstancesForRange(dayStart,dayEnd).forEach(evt=>{
      if(!filters.includes(evt.type)) return;
      const eDiv=document.createElement("div"); 
      eDiv.className="event "+evt.type+(evt.completed?" completed":"");
      eDiv.innerHTML=`<span>${evt.title}</span><button onclick="event.stopPropagation(); toggleCompleteFromCalendar('${evt.dateStr}',${evt.index})">✔️</button>`;
      eDiv.onclick=(ev)=>{ ev.stopPropagation(); openEventDetail(evt); };
      container.appendChild(eDiv);
    });
    cell.onclick=()=>openNewEvent(dateStr);
    calendar.appendChild(cell);
  }
  renderUpcoming();

  const monthSelect=document.getElementById('monthSelect');
  if(monthSelect){monthSelect.value=month;}
}

function toggleCompleteFromCalendar(dateStr,index){
  events[dateStr][index].completed=!events[dateStr][index].completed;
  saveEvents(); renderCalendar();
}

function renderUpcoming(){
  const upcomingList=document.getElementById("upcomingList"); upcomingList.innerHTML="";
  const today=new Date(); today.setHours(0,0,0,0);
  const sevenDaysLater=new Date(today); sevenDaysLater.setDate(today.getDate()+7);
  const upcoming=getEventInstancesForRange(today,sevenDaysLater);
  upcoming.sort((a,b)=>a.date-b.date || a.title.localeCompare(b.title));
  let currentGroup=null;
  upcoming.forEach(evt=>{
    const dateStr=evt.date.toISOString().split("T")[0];
    if(currentGroup!==dateStr){
      currentGroup=dateStr;
      const dateBox=document.createElement("div"); dateBox.className="upcoming-date-box";
      const dateHeader=document.createElement("div"); dateHeader.style.fontWeight="bold"; dateHeader.style.marginBottom="6px";
      dateHeader.textContent=evt.date.toLocaleDateString(undefined,{weekday:'short',day:'2-digit'});
      dateBox.appendChild(dateHeader); upcomingList.appendChild(dateBox);
    }
    const div=document.createElement("div"); 
    div.className="upcoming-event "+evt.type+(evt.completed?" completed":"");
    div.innerHTML=`<span>${evt.title}</span><button onclick="event.stopPropagation(); toggleCompleteFromCalendar('${evt.dateStr}',${evt.index})">✔️</button>`;
    div.onclick=()=>openEventDetail(evt);
    upcomingList.lastChild.appendChild(div);
  });
  
}
function applySeasonalTheme(month) {
  document.body.classList.remove("winter","spring","summer","autumn");
  if([11,0,1].includes(month)) { 
    document.body.classList.add("winter");
  } else if([2,3,4].includes(month)) { 
    document.body.classList.add("spring");
  } else if([5,6,7].includes(month)) { 
    document.body.classList.add("summer");
  } else if([8,9,10].includes(month)) { 
    document.body.classList.add("autumn");
  }
}
function goToToday(){
  currentDate = new Date();
  renderCalendar();
}
renderCalendar();
</script>
</body>
</html>
